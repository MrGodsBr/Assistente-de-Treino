<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-T"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fitness-Pro 2.0</title>
  <meta name="theme-color" content="#16a34a"/>
  <meta name="description" content="Fitness-Pro 2.0 - Assistente de nutrição e fitness"/>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
    #calorieProgress, #waterProgress, #weightProgress { transition: width 0.3s ease-in-out; }
    .modal-transition { transition: opacity 0.25s, transform 0.25s; }
    .spinner { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .meal-section { border-top: 1px solid #e5e7eb; padding-top: 1rem; }
    .meal-section:first-child { border-top: none; padding-top: 0; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-teal-50 min-h-screen flex flex-col items-center justify-start p-4 py-8">

  <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center transition-opacity duration-500">
    <div class="spinner rounded-full h-16 w-16 border-t-4 border-b-4 border-green-600"></div>
    <p class="text-xl font-semibold text-green-700 mt-4">Conectando ao app...</p>
  </div>
  
  <!-- MODAL: Registro/Edição -->
  <div id="fullRegistrationModalOverlay" class="modal-transition fixed inset-0 bg-black bg-opacity-70 z-40 hidden" role="presentation" aria-hidden="true"></div>
  <div id="fullRegistrationModal" class="modal-transition fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl z-50 hidden scale-90 opacity-0" role="dialog" aria-modal="true" aria-labelledby="regModalTitle">
    <h3 class="text-2xl font-bold text-gray-800 text-center mb-4" id="regModalTitle">Crie sua Conta</h3>
    <p id="regError" class="text-red-600 text-center font-medium text-sm mb-3 hidden"></p>

    <div class="space-y-4">
      <div class="flex flex-col items-center">
        <img id="regProfileImage" src="https://placehold.co/96x96/E0F2F1/065F46?text=FP" alt="Foto de Perfil" class="w-24 h-24 rounded-full object-cover shadow-lg mb-2 cursor-pointer" onclick="document.getElementById('regProfilePicInput').click()">
        <button type="button" onclick="document.getElementById('regProfilePicInput').click()" class="text-sm text-blue-600 hover:underline">Selecionar Foto</button>
        <input type="file" id="regProfilePicInput" class="hidden" accept="image/*"/>
      </div>

      <div>
        <label for="regUserNameInput" class="block text-sm font-medium text-gray-700">Nome de Usuário *</label>
        <input type="text" id="regUserNameInput" placeholder="Seu nome" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"/>
      </div>
      
      <div id="registrationFields">
        <div>
          <label for="regEmailInput" class="block text-sm font-medium text-gray-700">Email *</label>
          <input type="email" id="regEmailInput" placeholder="seu.email@exemplo.com" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"/>
        </div>
        <div>
          <label for="regPasswordInput" class="block text-sm font-medium text-gray-700">Senha * (Mín. 6 caracteres)</label>
          <div class="relative mt-1">
            <input type="password" id="regPasswordInput" placeholder="Sua senha" class="w-full p-2 pr-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"/>
            <button type="button" onclick="togglePasswordVisibility('regPasswordInput')" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700" aria-label="Mostrar/ocultar senha">
              <svg id="regPasswordInput_eye" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: block;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7.25M17.5 14.5c.89 0 1.611-.72 1.611-1.611s-.72-1.611-1.61-1.611-1.61.72-1.61 1.611.72 1.611 1.611 1.611zM12 5c4.478 0 8.268 2.943 9.543 7.25c-1.275 4.307-5.065 7.25-9.543 7.25-4.478 0-8.268-2.943-9.543-7.25 1.275-4.307 5.065-7.25 9.543-7.25zm0 0a3 3 0 100 6 3 3 0 000-6z" />
              </svg>
              <svg id="regPasswordInput_eye_open" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: none;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0zM12 19c-4.478 0-8.268-2.943-9.543-7.25C3.732 7.943 7.522 5 12 5s8.268 2.943 9.543 7.25c-1.275 4.307-5.065 7.25-9.543 7.25z" />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div>
        <label for="regPhoneInput" class="block text-sm font-medium text-gray-700">Telefone (opcional)</label>
        <input type="tel" id="regPhoneInput" placeholder="(99) 99999-9999" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"/>
      </div>

      <button id="registerAndProfileButton" class="w-full bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors mt-4">
        Criar Conta e Perfil
      </button>
      <button id="showLoginButton" class="w-full text-sm text-gray-600 font-medium py-2 mt-4 hover:text-gray-900">
        Já tenho conta. Fazer Login
      </button>
    </div>
  </div>

  <!-- MODAL: Login -->
  <div id="loginModalOverlay" class="modal-transition fixed inset-0 bg-black bg-opacity-70 z-40 hidden" role="presentation" aria-hidden="true"></div>
  <div id="loginModal" class="modal-transition fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl z-50 hidden scale-90 opacity-0" role="dialog" aria-modal="true" aria-labelledby="loginModalTitle">
    <h3 id="loginModalTitle" class="text-2xl font-bold text-gray-800 text-center mb-4">Fazer Login</h3>
    <p id="loginError" class="text-red-600 text-center font-medium text-sm mb-3 hidden"></p>

    <div class="space-y-4">
      <div>
        <label for="loginEmail" class="block text-sm font-medium text-gray-700">Email</label>
        <input type="email" id="loginEmail" placeholder="seu.email@exemplo.com" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"/>
      </div>
      <div>
        <label for="loginPassword" class="block text-sm font-medium text-gray-700">Senha</label>
        <div class="relative mt-1">
          <input type="password" id="loginPassword" placeholder="Sua senha" class="w-full p-2 pr-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"/>
          <button type="button" onclick="togglePasswordVisibility('loginPassword')" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500 hover:text-gray-700" aria-label="Mostrar/ocultar senha">
            <svg id="loginPassword_eye" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: block;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7.25M17.5 14.5c.89 0 1.611-.72 1.611-1.611s-.72-1.611-1.61-1.611-1.61.72-1.61 1.611.72 1.611 1.611 1.611zM12 5c4.478 0 8.268 2.943 9.543 7.25c-1.275 4.307-5.065 7.25-9.543 7.25-4.478 0-8.268-2.943-9.543-7.25 1.275-4.307 5.065-7.25 9.543-7.25zm0 0a3 3 0 100 6 3 3 0 000-6z" />
            </svg>
            <svg id="loginPassword_eye_open" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: none;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0zM12 19c-4.478 0-8.268-2.943-9.543-7.25C3.732 7.943 7.522 5 12 5s8.268 2.943 9.543 7.25c-1.275 4.307-5.065 7.25-9.543 7.25z" />
            </svg>
          </button>
        </div>
      </div>
      <button id="loginSubmitButton" class="w-full bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors mt-4">
        Entrar
      </button>
      <button id="showRegistrationButton" class="w-full text-sm text-gray-600 font-medium py-2 mt-4 hover:text-gray-900">
        Não tenho conta. Criar Perfil
      </button>
    </div>
  </div>

  <!-- MODAL: Alerta Meta -->
  <div id="warningModalOverlay" class="modal-transition fixed inset-0 bg-black bg-opacity-70 z-40 hidden"></div>
  <div id="warningModal" class="modal-transition fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl z-50 hidden scale-90 opacity-0">
    <div class="text-center">
      <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100">
        <svg class="h-10 w-10 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
        </svg>
      </div>
      <h3 class="text-2xl font-bold text-gray-800 mt-4">Meta Atingida!</h3>
      <p class="text-base text-gray-600 mt-2">Você ultrapassou sua meta de calorias do dia.</p>
      <p id="modalGoalText" class="text-sm text-gray-500 mt-1"></p>
      <button id="closeWarningModalButton" class="mt-6 w-full bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors">
        Entendi
      </button>
    </div>
  </div>

  <!-- APP -->
  <div id="mainApp" class="bg-white w-full max-w-lg p-6 sm:p-8 rounded-2xl shadow-xl space-y-6 hidden">

    <header class="flex justify-between items-center border-b pb-4">
      <h1 class="text-3xl font-bold text-green-600">Fitness-Pro 2.0</h1>
      <button id="shareAppButton" class="text-blue-600 p-2 rounded-full hover:bg-gray-100 transition-colors" title="Compartilhar o App" aria-label="Compartilhar o App">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle>
          <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.42" y1="6.51" x2="8.59" y2="10.49"></line>
        </svg>
      </button>
    </header>

    <div id="userProfileDisplay" class="flex items-center space-x-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
      <img id="profileImageDisplay" src="https://placehold.co/64x64/E0F2F1/065F46?text=FP" alt="Foto de Perfil" class="w-16 h-16 rounded-full object-cover shadow-md"/>
      <div class="flex-grow">
        <span id="userNameDisplay" class="block text-xl font-semibold text-gray-800">Usuário</span>
        <button id="authControlButton" class="text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors mt-1">
          Fazer Login / Criar Conta
        </button>
      </div>
      <button id="editProfileButton" class="text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors">Editar</button>
    </div>
    
    <details id="goalsDetails" class="bg-gray-50 p-4 rounded-lg border border-gray-200">
      <summary class="text-xl font-semibold text-gray-700 cursor-pointer list-none">
        <div class="flex justify-between items-center text-green-600">
          <span>Minhas Metas</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </div>
      </summary>
      <div id="profileForm" class="mt-4 grid grid-cols-2 sm:grid-cols-3 gap-4">
        <div>
          <label for="weight" class="block text-sm font-medium text-gray-700">Peso Atual (kg)</label>
          <input type="number" id="weight" placeholder="70" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"/>
        </div>
        <div>
          <label for="targetWeight" class="block text-sm font-medium text-gray-700">Meta Peso (kg)</label>
          <input type="number" id="targetWeight" placeholder="75" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"/>
        </div>
        <div>
          <label for="height" class="block text-sm font-medium text-gray-700">Altura (cm)</label>
          <input type="number" id="height" placeholder="175" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"/>
        </div>
        <div>
          <label for="age" class="block text-sm font-medium text-gray-700">Idade</label>
          <input type="number" id="age" placeholder="25" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"/>
        </div>
        <div class="col-span-2 sm:col-span-3">
          <label for="gender" class="block text-sm font-medium text-gray-700">Gênero</label>
          <select id="gender" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="male">Masculino</option>
            <option value="female">Feminino</option>
          </select>
        </div>
        <div class="col-span-2 sm:col-span-3">
          <label for="activity" class="block text-sm font-medium text-gray-700">Nível de Atividade</label>
          <select id="activity" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="1.2">Sedentário (pouco ou nenhum)</option>
            <option value="1.375">Leve (1-3 dias/semana)</option>
            <option value="1.55" selected>Moderado (3-5 dias/semana)</option>
            <option value="1.725">Ativo (6-7 dias/semana)</option>
            <option value="1.9">Muito Ativo (trabalho físico + treino)</option>
          </select>
        </div>
        <div class="col-span-2 sm:col-span-3">
          <label for="goalType" class="block text-sm font-medium text-gray-700">Meu Objetivo</label>
          <select id="goalType" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="ganhar">Ganhar Massa (Bulking)</option>
            <option value="manter">Manter Peso (Manutenção)</option>
            <option value="perder">Perder Peso (Cutting)</option>
          </select>
        </div>
        <button id="calculateButton" class="col-span-2 sm:col-span-3 w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
          Calcular e Salvar Meta
        </button>
      </div>
      <p id="goalText" class="text-center text-lg font-semibold text-green-700 mt-4 hidden"></p>
    </details>

    <!-- Adicionar Alimento -->
    <div id="addFoodSection">
      <h2 class="text-xl font-semibold text-gray-700 mb-3">Adicionar Alimento</h2>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-start">
        <div class="relative sm:col-span-3">
          <label for="foodSearch" class="block text-sm font-medium text-gray-700 mb-1">1. Pesquisar Alimento</label>
          <input type="text" id="foodSearch" placeholder="Digite o nome do alimento..." class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500" autocomplete="off"/>
          <div id="searchDropdown" class="hidden absolute z-10 w-full bg-white border border-gray-300 rounded-b-lg shadow-lg max-h-56 overflow-y-auto"></div>
        </div>

        <div class="sm:col-span-2">
          <label for="mealTimeSelect" class="block text-sm font-medium text-gray-700 mb-1">2. Escolher Refeição</label>
          <select id="mealTimeSelect" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 bg-white">
            <option value="cafe_da_manha">Café da Manhã</option>
            <option value="almoco">Almoço</option>
            <option value="lanche">Lanche</option>
            <option value="jantar">Jantar</option>
          </select>
        </div>

        <div class="sm:col-span-1">
          <label for="foodQuantity" class="block text-sm font-medium text-gray-700 mb-1">3. Qtd.</label>
          <input type="number" id="foodQuantity" placeholder="Qtd." min="0" step="0.1" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"/>
        </div>

        <div id="mealSuggestion" class="text-sm text-gray-600 mt-1 sm:col-span-3 px-1"></div>

        <button id="addFoodButton" class="sm:col-span-3 w-full bg-green-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors mt-3">
          Adicionar Alimento
        </button>
        <button id="shareButton" class="sm:col-span-3 w-full bg-cyan-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-colors mt-3">
          Compartilhar Resumo no WhatsApp
        </button>
      </div>
    </div>

    <!-- Histórico e Hidratação -->
    <div class="border-t border-gray-200 pt-4">
      <label for="dateSelector" class="block text-lg font-semibold text-gray-700 mb-2">Histórico:</label>
      <input type="date" id="dateSelector" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white"/>
      <p id="dateStatus" class="text-sm text-gray-500 mt-1 text-center"></p>
    </div>

    <div id="hydrationTracker" class="border-t border-gray-200 pt-4 pb-4">
      <h2 class="text-xl font-semibold text-blue-600 mb-3">💧 Adicionar Hidratação</h2>
      <div class="flex items-end space-x-3 mb-4">
        <div class="flex-grow">
          <label for="waterQuantityInput" class="block text-sm font-medium text-gray-700">Qtd. de Água (ml)</label>
          <input type="number" id="waterQuantityInput" placeholder="250" min="50" step="50" value="250" class="mt-1 w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"/>
        </div>
        <button id="addWaterButton" class="h-10 bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
          Adicionar
        </button>
      </div>
    </div>

    <!-- Lista do dia -->
    <div class="border-b border-gray-200 py-4">
      <h3 class="text-xl font-semibold text-gray-700 mb-3 flex items-center justify-between space-x-2">
        <span>Refeições do Dia:</span>
        <span id="goalTag" class="text-xs font-medium text-blue-700 bg-blue-100 py-0.5 px-2 rounded-full flex-shrink-0 hidden"></span>
      </h3>
      <div id="foodList" class="overflow-y-auto border border-gray-200 rounded-lg p-4 space-y-4 bg-gray-50 min-h-48">
        <p id="emptyListText" class="text-gray-400 text-center mt-4">Nenhum alimento adicionado ainda.</p>
        <div id="water_container" class="mb-2 meal-section"> 
          <h4 class="font-semibold text-gray-700 mb-2 text-lg">💧 Registros de Água</h4>
          <div class="space-y-2" id="list-water"></div>
        </div>
        <div id="cafe_da_manha_container"></div>
        <div id="almoco_container"></div>
        <div id="lanche_container"></div>
        <div id="jantar_container"></div>
      </div>
      <p class="text-xs text-gray-500 mt-2">⚠️ indica alimentos que podem aumentar a gordura visceral.</p>
    </div>

    <!-- Resumo -->
    <div class="space-y-4">
      <h2 class="text-xl font-semibold text-gray-800 text-center">Resumo do Dia</h2>
      
      <div id="weightProgressSection">
        <div class="flex justify-between items-center mb-1">
          <span class="text-base font-medium text-indigo-600">Meta de Peso</span>
          <span id="weightGoalText" class="text-sm font-semibold text-indigo-600">0 kg / 0 kg</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-4 shadow-inner">
          <div id="weightProgress" class="bg-indigo-500 h-4 rounded-full" style="width: 0%"></div>
        </div>
      </div>

      <div>
        <div class="flex justify-between items-center mb-1">
          <span class="text-base font-medium text-blue-600">Água</span>
          <span id="waterGoalText" class="text-sm font-semibold text-blue-600">Consumo: 0 ml / Meta: 0 ml</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-4 shadow-inner">
          <div id="waterProgress" class="bg-blue-500 h-4 rounded-full" style="width: 0%"></div>
        </div>
      </div>

      <div>
        <div class="flex justify-between items-center mb-1">
          <span class="text-base font-medium text-orange-600">Calorias</span>
          <span id="totalCalsGoalText" class="text-sm font-semibold text-orange-600">0 / 0 kcal</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-4 shadow-inner">
          <div id="calorieProgress" class="bg-orange-500 h-4 rounded-full" style="width: 0%"></div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4 text-center">
        <div>
          <p class="text-base font-medium text-emerald-600 mb-1">Proteínas</p>
          <p id="totalProteins" class="text-3xl font-bold text-emerald-600">0 g</p>
        </div>
        <div>
          <p class="text-base font-medium text-blue-600 mb-1">Carboidratos</p>
          <p id="totalCarbs" class="text-3xl font-bold text-blue-600">0 g</p>
        </div>
      </div>
    </div>
  </div>

  <footer class="mt-8 text-sm text-gray-500">Desenvolvido por Thiago</footer>

  <script>
    // Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC9WSxM9GA64fq9lkLhsTyvMbD1AlO1MM4",
      authDomain: "assistente-de-treino-668ce.firebaseapp.com",
      projectId: "assistente-de-treino-668ce",
      storageBucket: "assistente-de-treino-668ce.firebasestorage.app",
      messagingSenderId: "878456748339",
      appId: "1:878456748339:web:5b310b5e91a7b23d0ba646",
      measurementId: "G-FCQ5CQT1WY"
    };

    let firebaseApp, firebaseAuth, firebaseDb, userId = null;

    // Estado
    let calorieGoal = 0;
    let waterGoal = 0; 
    let currentWeight = 0; 
    let targetWeight = 0; 
    let selectedFoodKey = null;
    let dailyLog = {}; 
    let waterLog = 0; 
    const TODAY = new Date(); 
    TODAY.setHours(0, 0, 0, 0); 
    const todayDateString = TODAY.toISOString().split('T')[0]; 
    let currentDateString = todayDateString; 
    let goalExceededNotified = false;
    let profilePicBase64 = null;
    let isEditingProfile = false;
    let currentGoalType = 'ganhar';
    let unsubscribeListener = null; 

    const MEAL_KEYS = ['cafe_da_manha', 'almoco', 'lanche', 'jantar'];
    const mealDisplayNames = {
      cafe_da_manha: "☕ Café da Manhã",
      almoco: "🍽️ Almoço",
      lanche: "🍎 Lanche",
      jantar: "🍲 Jantar",
    };
    const ALL_LOG_KEYS = ['water', ...MEAL_KEYS];

    const goalDisplayNames = {
      ganhar: 'Ganho de Massa',
      manter: 'Manutenção',
      perder: 'Perda de Peso'
    };

    const mealSuggestions = {
      ganhar: {
        cafe_da_manha: "Ex: Ovos, Aveia, Banana, Whey Protein.",
        almoco: "Ex: Arroz, Peito de Frango, Feijão, Batata Doce.",
        lanche: "Ex: Pão Integral, Pasta de Amendoim, Iogurte Grego.",
        jantar: "Ex: Macarrão, Carne Moída, Salada com Azeite.",
      },
      perder: {
        cafe_da_manha: "Ex: Ovos, Morangos, Café Preto, Iogurte Natural.",
        almoco: "Ex: Salada, Tilápia, Brócolis, Pouco Arroz Integral.",
        lanche: "Ex: Maçã, Queijo Minas, Castanhas (pouco).",
        jantar: "Ex: Sopa de legumes, Peito de Frango, Alface.",
      },
      manter: {
        cafe_da_manha: "Refeição balanceada. Ex: Pão Integral, Ovos, Mamão.",
        almoco: "Equilibre prato. Ex: Arroz, Feijão, Bife, Salada.",
        lanche: "Ex: Uvas, Iogurte, Aveia.",
        jantar: "Refeição leve. Ex: Batata Doce, Frango, Brócolis.",
      }
    };

    // Banco de alimentos (igual ao seu original, omitido aqui por brevidade)
    const foodDatabase = {
      'banana': { name: 'Banana', protein: 1.1, carbs: 27, cals: 105, unit: 'unidade', visceralFat: false },
      // ... mantenha seus itens aqui
    };

    // Helpers Firebase
    function getDayRef(uid, date) { return firebaseDb.collection('users').doc(uid).collection('days').doc(date); }
    function getItemsRef(uid, date) { return getDayRef(uid, date).collection('items'); }
    function getProfileDocRef() { return firebaseDb.collection('users').doc(userId).collection('data').doc('profile'); }
    function getMetasDocRef() { return firebaseDb.collection('users').doc(userId).collection('data').doc('metas'); }

    // UI Helpers
    function showElement(el){ el.classList.remove('hidden'); }
    function hideElement(el){ el.classList.add('hidden'); }
    function showModal(modal, overlay){
      showElement(overlay); showElement(modal);
      requestAnimationFrame(()=>{ modal.classList.remove('scale-90','opacity-0'); modal.classList.add('scale-100','opacity-100'); });
    }
    function hideModal(modal, overlay){
      modal.classList.remove('scale-100','opacity-100');
      modal.classList.add('scale-90','opacity-0');
      setTimeout(()=>{ hideElement(modal); hideElement(overlay); }, 250);
    }
    function showRegError(message){ const el=document.getElementById('regError'); el.textContent=message; showElement(el); }
    function clearRegError(){ const el=document.getElementById('regError'); el.textContent=''; hideElement(el); }
    function showLoginError(message){ const el=document.getElementById('loginError'); el.textContent=message; showElement(el); }
    function clearLoginError(){ const el=document.getElementById('loginError'); el.textContent=''; hideElement(el); }
    function togglePasswordVisibility(fieldId) {
      const input = document.getElementById(fieldId);
      const eye = document.getElementById(fieldId + '_eye');
      const eyeOpen = document.getElementById(fieldId + '_eye_open');
      if (input.type === 'password') { input.type = 'text'; hideElement(eye); showElement(eyeOpen); }
      else { input.type = 'password'; showElement(eye); hideElement(eyeOpen); }
    }

    // File -> Base64 (somente localStorage, sem Firebase)
    function fileToBase64(file){
      return new Promise((resolve,reject)=>{
        const r=new FileReader();
        r.onload=()=>resolve(r.result);
        r.onerror=e=>reject(e);
        r.readAsDataURL(file);
      });
    } // FileReader docs [web:72]

    function saveProfilePicLocally(){
      if(profilePicBase64 && userId){
        localStorage.setItem(`profilePic_${userId}`, profilePicBase64);
        document.getElementById('profileImageDisplay').src=profilePicBase64;
        document.getElementById('regProfileImage').src=profilePicBase64;
      }
    }
    function loadProfilePicLocally(){
      if(!userId) return;
      const pic=localStorage.getItem(`profilePic_${userId}`);
      if(pic){
        profilePicBase64=pic;
        document.getElementById('profileImageDisplay').src=pic;
        document.getElementById('regProfileImage').src=pic;
      }
    }

    // Modal Registro/Edição
    function showRegistrationModal(isEdit = false) {
      isEditingProfile = isEdit;
      const modal = document.getElementById('fullRegistrationModal');
      const overlay = document.getElementById('fullRegistrationModalOverlay');
      clearRegError();

      const regFields = document.getElementById('registrationFields');
      const saveButton = document.getElementById('registerAndProfileButton');
      const showLogin = document.getElementById('showLoginButton');
      const titleEl = document.getElementById('regModalTitle');

      const nameInput = document.getElementById('regUserNameInput');
      const emailInput = document.getElementById('regEmailInput');
      const passInput  = document.getElementById('regPasswordInput');
      const phoneInput = document.getElementById('regPhoneInput');

      if (isEdit) {
        titleEl.textContent = 'Editar Perfil';
        regFields.classList.add('hidden');
        showLogin.classList.add('hidden');
        saveButton.textContent = 'Salvar Perfil';
        // Prefill
        if (userId && firebaseDb) {
          getProfileDocRef().get().then(doc => {
            if (doc.exists) {
              const data = doc.data() || {};
              nameInput.value = data.name || '';
              phoneInput.value = data.phone || '';
            }
          }).catch(()=>{});
        }
        emailInput.value=''; passInput.value='';
      } else {
        titleEl.textContent = 'Crie sua Conta';
        regFields.classList.remove('hidden');
        showLogin.classList.remove('hidden');
        saveButton.textContent = 'Criar Conta e Perfil';
        nameInput.value=''; emailInput.value=''; passInput.value=''; phoneInput.value='';
      }

      document.body.style.overflow='hidden';
      showModal(modal, overlay);
      // Foco inicial
      setTimeout(()=>{ (isEdit ? document.getElementById('regUserNameInput') : document.getElementById('regEmailInput'))?.focus(); }, 50);
    }
    function closeRegistrationModal(){
      const modal = document.getElementById('fullRegistrationModal');
      const overlay = document.getElementById('fullRegistrationModalOverlay');
      hideModal(modal, overlay);
      document.body.style.overflow='';
      clearRegError();
    }

    // Modal Login
    function showLoginModal(){
      clearLoginError();
      const modal = document.getElementById('loginModal');
      const overlay = document.getElementById('loginModalOverlay');
      document.body.style.overflow='hidden';
      showModal(modal, overlay);
      setTimeout(()=>{ document.getElementById('loginEmail')?.focus(); }, 50);
    }
    function closeLoginModal(){
      const modal = document.getElementById('loginModal');
      const overlay = document.getElementById('loginModalOverlay');
      hideModal(modal, overlay);
      document.body.style.overflow='';
      clearLoginError();
    }

    // Registro e Edição (somente perfil/Firestore; foto é localStorage)
    async function handleRegister() {
      clearRegError();
      const name = document.getElementById('regUserNameInput').value.trim();
      const email = document.getElementById('regEmailInput').value.trim();
      const pass  = document.getElementById('regPasswordInput').value;
      const phone = document.getElementById('regPhoneInput').value.trim();

      if (!name || !email || pass.length < 6) {
        showRegError('Preencha nome, email válido e senha (mín. 6).');
        return;
      }

      try {
        const cred = await firebaseAuth.createUserWithEmailAndPassword(email, pass);
        userId = cred.user.uid;
        await getProfileDocRef().set({
          name, phone: phone || null, createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        await getMetasDocRef().set({ goalType: currentGoalType || 'ganhar' }, { merge: true });
        saveProfilePicLocally();
        closeRegistrationModal();
        loadProfilePicLocally();
        document.getElementById('userNameDisplay').textContent = name || 'Usuário';
      } catch (e) {
        showRegError('Erro ao criar conta. Verifique os dados.');
      }
    }

    async function handleProfileSave() {
      clearRegError();
      const name = document.getElementById('regUserNameInput').value.trim();
      const phone = document.getElementById('regPhoneInput').value.trim();
      if (!userId) { showRegError('Faça login para editar.'); return; }
      if (!name) { showRegError('Informe seu nome.'); return; }

      try {
        await getProfileDocRef().set({
          name, phone: phone || null, updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        saveProfilePicLocally();
        closeRegistrationModal();
        document.getElementById('userNameDisplay').textContent = name || 'Usuário';
      } catch (e) {
        showRegError('Erro ao salvar perfil.');
      }
    }

    // Auth init
    function initFirebase(){
      firebaseApp = firebase.initializeApp(firebaseConfig);
      firebaseAuth = firebase.auth();
      firebaseDb = firebase.firestore();

      firebaseAuth.onAuthStateChanged(user=>{
        if(user){
          userId = user.uid;
          document.getElementById('authControlButton').textContent = 'Sair';
          // Carrega nome e foto local
          getProfileDocRef().get().then(doc=>{
            const data = doc.exists ? doc.data() : {};
            document.getElementById('userNameDisplay').textContent = data.name || 'Usuário';
            loadProfilePicLocally();
          });
          showElement(document.getElementById('mainApp'));
        } else {
          userId = null;
          document.getElementById('authControlButton').textContent = 'Fazer Login / Criar Conta';
          document.getElementById('userNameDisplay').textContent = 'Usuário';
          document.getElementById('profileImageDisplay').src='https://placehold.co/64x64/E0F2F1/065F46?text=FP';
          showElement(document.getElementById('mainApp'));
        }
        document.getElementById('loadingScreen').classList.add('opacity-0');
        setTimeout(()=>{ hideElement(document.getElementById('loadingScreen')); }, 300);
      });
    }

    // Eventos UI principais
    window.addEventListener('DOMContentLoaded', ()=>{
      initFirebase();

      // Botões modais Registro/Login
      document.getElementById('authControlButton').addEventListener('click', ()=>{
        if (userId) { firebaseAuth.signOut(); }
        else { showRegistrationModal(false); }
      });
      document.getElementById('editProfileButton').addEventListener('click', ()=>{
        if (!userId) { showRegistrationModal(false); }
        else { showRegistrationModal(true); }
      });
      document.getElementById('showLoginButton').addEventListener('click', ()=>{
        closeRegistrationModal();
        showLoginModal();
      });
      document.getElementById('showRegistrationButton').addEventListener('click', ()=>{
        closeLoginModal();
        showRegistrationModal(false);
      });

      // Fechar clicando fora
      document.getElementById('fullRegistrationModalOverlay').addEventListener('click', closeRegistrationModal);
      document.getElementById('loginModalOverlay').addEventListener('click', closeLoginModal);

      // Registro/Edição
      document.getElementById('registerAndProfileButton').addEventListener('click', ()=>{
        if (isEditingProfile) return handleProfileSave();
        return handleRegister();
      });

      // Login
      document.getElementById('loginSubmitButton').addEventListener('click', async ()=>{
        clearLoginError();
        const email=document.getElementById('loginEmail').value.trim();
        const pass=document.getElementById('loginPassword').value;
        if(!email || !pass){ showLoginError('Informe email e senha.'); return; }
        try {
          await firebaseAuth.signInWithEmailAndPassword(email, pass);
          closeLoginModal();
        } catch(e){
          showLoginError('Falha no login. Verifique suas credenciais.');
        }
      });

      // Foto de perfil (somente localStorage)
      document.getElementById('regProfilePicInput').addEventListener('change', async (e)=>{
        const file = e.target.files?.[0];
        if(!file) return;
        try{
          // Opcional: aqui poderia comprimir antes
          profilePicBase64 = await fileToBase64(file);
          document.getElementById('regProfileImage').src = profilePicBase64;
        }catch(err){}
      });
    });
  </script>
</body>
</html>
